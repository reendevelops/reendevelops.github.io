<! DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="../css/content.css">
</head>

<body>
    <div class="background">

        <canvas id="myCanvas" width="400" height="300" style="border:1px solid black;"></canvas>

        <h1>Begin the journey!</h1>
        <p id="mouseTest">Mouse press: </p>
        <p id="position">Circle position: </p>

        <script>
            const canvas = document.getElementById("myCanvas");
            const ctx = canvas.getContext("2d");

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            // starting position
            let playerPos = { x: 190, y: 420 };
            let moveSpeed = 2;

            // mouse position
            let mousePos = { x: 0, y: 0 };
            let isPressed = false;

            // destination position
            let destination = { x: playerPos.x, y: playerPos.y };
            let distanceAllowance = 5; // how close is close enough

            // Load your image
            const playerImage_Right = new Image();
            const playerImage_Left = new Image();
            playerImage_Right.src = "../img/player.png";
            playerImage_Left.src = "../img/playerL.png";

            // Wait for the image to load before drawing
            playerImage_Right.onload = function () {
                requestAnimationFrame(update);
            };
            playerImage_Left.onload = function () {
                requestAnimationFrame(update);
            };

            // Detect mouse movement
            canvas.addEventListener("mousemove", (event) => {
                const rect = canvas.getBoundingClientRect(); // canvas position on page
                mousePos.x = event.clientX - rect.left; // x relative to canvas
                mousePos.y = event.clientY - rect.top;  // y relative to canvas
            });

            // Detect mouse press
            canvas.addEventListener("mousedown", () => {
                isPressed = true;

                // set destination on click
                const rect = canvas.getBoundingClientRect(); // canvas position on page
                destination.x = event.clientX - rect.left; // x relative to canvas
                destination.y = event.clientY - rect.top;  // y relative to canvas

                document.getElementById("mouseTest").innerHTML = "Mouse press: " + destination.x + ", " + destination.y;
            });

            // Detect mouse release
            canvas.addEventListener("mouseup", () => {
                isPressed = false;
            });

            function update() {
                // clear the previous frame
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // always move the player towards the destination
                const dx = destination.x - playerPos.x;
                const dy = destination.y - playerPos.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                // move playerPos toward destination if not too close
                if (distance > distanceAllowance) {
                    playerPos.x += (dx / distance) * moveSpeed;
                    playerPos.y += (dy / distance) * moveSpeed;
                }
                document.getElementById("position").innerHTML = "Player position: " + playerPos.x + ", " + playerPos.y;

                // If player is heading left.
                if (destination.x < playerPos.x)
                    ctx.drawImage(playerImage_Left, playerPos.x - playerImage_Left.width / 4, playerPos.y - playerImage_Left.height / 2.5, playerImage_Left.width / 2, playerImage_Left.height / 2);
                else
                    ctx.drawImage(playerImage_Right, playerPos.x - playerImage_Right.width / 4, playerPos.y - playerImage_Right.height / 2.5, playerImage_Right.width / 2, playerImage_Right.height / 2);

                // Draw a cirlce following the mouse
                ctx.beginPath();
                ctx.arc(mousePos.x, mousePos.y, 20, 0, Math.PI * 2);
                ctx.fillStyle = "rgba(232, 100, 27, 0.5)";
                ctx.fill();

                // call draw() again for the next frame
                requestAnimationFrame(update);
            }

            // start animation
            update();
        </script>
    </div>

</body>
</html>
